<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Conclusion</title>
    <style type="text/css">
        input#Category {
            background-color:rgba(0, 0, 0, 0);
            color:black;
            border: none;
            outline:none;

        }

        .next {
            float: right;
            background-color: #4CAF50;
            color: white;
		}
        .previous {
            float: right;
            background-color: #bac1ba;
            color: black;
	    }

	    div#nav {
	        height: 5px;
	    }
    </style>

</head>
<script src='https://d3js.org/d3.v5.min.js'></script>
<body onload="init()">
<div>
    <!-- Trigger -->
    <left>
        <label for="mpgCategory">Select MPG category</label>
        <select id="mpgCategory" onchange="changeCategory()"></select>
    </left>
</div>

<div>
    <h3> <label for="Category">Top 10 based on </label>
        <input style="font: 30px sans-serif ;" id="Category" value="Average City MPG" disabled ></h3>
    <svg></svg>
</div>

<script defer>
// Define canvas scales
var svgWidth = screen.width - 60;
var svgHeight = 300;
var margin = 95;
var width = svgWidth -  margin;
var height = svgHeight -  2 * margin;

var xs;
var ys;


// Define triggers
var categories = [{"label":"Average City MPG", "value": "AverageCityMPG"},
                  {"label": "Average Highway MPG", "value": "AverageHighwayMPG"}];

var svg = d3.select("svg")
            .attr("width", svgWidth)
            .attr("height", svgHeight);

var x_axis = svg.append("g")
                .attr("class", "xAxis")
                .attr("transform", "translate("+margin+","+(height + margin)+")");

var y_axis = svg.select("g")
                .attr("class", "yAxis")
                .attr("transform", "translate("+margin+","+margin+")");

async function init() {
    const data = await d3.csv("cars2017.csv", function(d) {
        return {Make: d.Make+"_"+d.EngineCylinders, Fuel: d.Fuel, EngineCylinders: d.EngineCylinders, AverageHighwayMPG: d.AverageHighwayMPG, AverageCityMPG: d.AverageCityMPG, OnlyMake: d.Make }
    });

    xs = d3.scaleBand().padding(0.1).range([0, width]);
    ys = d3.scaleLinear().range([height, 0]);


    // https://stackoverflow.com/questions/24588883/populate-dropdown-list-with-csv-file-d3
    d3.select("#mpgCategory")
        .selectAll("option")
        .data(categories)
        .enter()
        .append("option")
        .attr("value", function (d) { return d.value; })
        .text(function (d) { return d.label; });

    updateChart(data);
}

function updateChart(data) {

    var cat = document.getElementById("mpgCategory");
    var category = cat.options[cat.selectedIndex].text;

    var topData = data.sort(function(a,b) {
        return a[category] - b[category];
    }).slice(0, 10);
    console.log(topData);

    svg.append("g")
        .attr("transform", "translate("+margin+","+margin+")")
        .selectAll("rect."+className)
            .data(data)
            .enter()
            .append("rect")
                .attr("x", function(d) {return xs(d.Make);})
                .attr("y", function(d) {return  ys(d[category])})
                .attr("width", xs.bandwidth())
                .attr("height", function(d) {return height - ys(d[category]);});

}

// Modify screen description based on MPG Category
async function changeCategory() {
    // Read data
    const data = await d3.csv("cars2017.csv", function(d) {
        return {Make: d.Make+"_"+d.EngineCylinders, Fuel: d.Fuel, EngineCylinders: d.EngineCylinders, AverageHighwayMPG: d.AverageHighwayMPG, AverageCityMPG: d.AverageCityMPG, OnlyMake: d.Make }
    });
    data.sort(function(a,b) {
        return a.EngineCylinders - b.EngineCylinders;
    });

    var cat = document.getElementById("mpgCategory");
    document.getElementById("Category").value = cat.options[cat.selectedIndex].text;
    selectedCategory = cat.options[cat.selectedIndex].value;
    updateChart(data);
}

</script>

</body>
</html>